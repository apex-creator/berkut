<!-- HTML header for doxygen 1.8.11-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<link rel="shortcut icon" href="favicon.png" type="image/png">    
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<title>xWRL6432 MMWAVE-L-SDK: Aoa2dproc</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<style>
.tinav {
    background: #c00;
    /* height: 41.375px; */
    height: 30px;
    }
</style>    
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() {
    if ($('.searchresults').length > 0) { searchBox.DOMSearchField().focus(); }
  });
  /* @license-end */
</script>
<link rel="search" href="search_opensearch.php?v=opensearch.xml" type="application/opensearchdescription+xml" title="xWRL6432 MMWAVE-L-SDK"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 40px;">
  <td id="projectlogo"><a href="https://www.ti.com"><img alt="Logo" src="ti_logo.svg"/></a></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">xWRL6432 MMWAVE-L-SDK
   &#160;<span id="projectnumber">05.05.04.02</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
          <div class="left">
            <form id="FSearchBox" action="search.html" method="get">
              <img id="MSearchSelect" src="search/mag.svg" alt=""/>
              <input type="text" id="MSearchField" name="query" value="Search" size="20" accesskey="S" 
                     onfocus="searchBox.OnSearchFieldFocus(true)" 
                     onblur="searchBox.OnSearchFieldFocus(false)"/>
            </form>
          </div><div class="right"></div>
        </div>
</td>
 </tr>
 </tbody>
</table>
<div class=tinav></div>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('AOA2DPROC_PAGE.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Aoa2dproc </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md553">Introduction</a></li>
<li class="level1"><a href="#autotoc_md554">Block Diagram</a></li>
<li class="level1"><a href="#autotoc_md555">AOA2D DPU Functioning</a></li>
<li class="level1"><a href="#autotoc_md556">Usage Overview</a><ul><li class="level2"><a href="#autotoc_md557">API</a></li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md558">Example Usage</a></li>
</ul>
</div>
<div class="textblock"><p><a class="anchor" id="md_components_datapath_aoa2dproc"></a></p>
<h1><a class="anchor" id="autotoc_md553"></a>
Introduction</h1>
<p>This DPU is used in the radar signal processing chains where the object detection is performed on the range-doppler detection matrix. The top-level diagram is shown below. The input to this DPU consists of:</p><ul>
<li>the list of points detected by CFAR DPU, the range-doppler list. Each point in the list is described with the following fields: {range index, doppler index, range (m), Doppler (m/s), Snr (dB) and noise (dB)},</li>
<li>the radar cube matrix.</li>
</ul>
<p>The output of this DPU is a final point-cloud list in Cartesian format. The AoA2D DPU currently supports only the BPM-MIMO modulation scheme and a uniform (â€œnormal modeâ€) chirp configuration. The detected points in the input range-doppler list are described by the following structure.</p>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>DPIF_CFARRngDopDetListElement_t</div>
<div class="line">{</div>
<div class="line"><span class="keywordtype">float</span> range; </div>
<div class="line"><span class="keywordtype">float</span> doppler; </div>
<div class="line">uint16_t rangeIdx;</div>
<div class="line">int16_t dopplerIdx; </div>
<div class="line"><span class="keywordtype">float</span> snrdB; </div>
<div class="line"><span class="keywordtype">float</span> noisedB; </div>
<div class="line">} DPIF_CFARRngDopDetListElement;</div>
</div><!-- fragment --><p> Note that the field range, contains the range value already compensated by the range bias, provided in the CLI configuration command compRangeBiasAndRxChanPhase.</p>
<h1><a class="anchor" id="autotoc_md554"></a>
Block Diagram</h1>
<p>The top-level block diagram of the DPU is shown in the figure below.</p>
<p> <style>div.image img[src="aoa2dproc.png"]{width:80%}</style> </p><div class="image">
<img src="aoa2dproc.png" alt=""/>
<div class="caption">
AOA2D DPU top-level diagram</div></div>
<p>AoA2D DPU for 2D virtual antenna pattern - detailed diagram.</p>
<p> <style>div.image img[src="aoa2dproc_dataflow.png"]{width:50%}</style> </p><div class="image">
<img src="aoa2dproc_dataflow.png" alt=""/>
<div class="caption">
AoA2D DPU for 2D virtual antenna pattern</div></div>
<p>AoA2D DPU for 1D virtual antenna pattern - detailed diagram.</p>
<p> <style>div.image img[src="aoa2dproc_dataflow1.png"]{width:50%}</style> </p><div class="image">
<img src="aoa2dproc_dataflow1.png" alt=""/>
<div class="caption">
AoA2D DPU for 1D virtual antenna pattern</div></div>
<p>AOA2D DPU processing flow.</p>
<p> <style>div.image img[src="aoa2dproc_state_machine.png"]{width:40%}</style> </p><div class="image">
<img src="aoa2dproc_state_machine.png" alt=""/>
<div class="caption">
AOA2D DPU processing flow</div></div>
<h1><a class="anchor" id="autotoc_md555"></a>
AOA2D DPU Functioning</h1>
<p>At the beginning of the processing, based on the input range-doppler detection list, the DPU creates a temporary list with the elements containing a pair of values: the active range gate (range gate at which at least one point is detected in the doppler domain) and the number of detected points at that range gate. Note that the assumption is made that the input range-doppler list has already been sorted (by the CFAR DPU) based on the range field in ascending order. Since the Doppler FFT output symbols are not preserved during the Doppler DPU processing, the Doppler FFT is recalculated for each active range gate. Then, for each detected point in the group, at the detected range and Doppler index pair, the DPU performs the following operations:</p><ul>
<li>it maps the antenna symbols from the detected range and Doppler index pair into a 2D virtual antenna array,</li>
<li>it then computes 2D azimuth/elevation FFT on the virtual antenna array, based on the peaks in the azimuth domain and corresponding positions in the elevation domain, it calculates the coordinates of the detected points in Cartesian format. The Doppler FFT size is equal to the next power of two greater than or equal to the number of physical chirps in the frame. Note that as currently the DPU supports only the 2Tx-BPM MIMO modulation with the uniform chirp distribution, the scheme can be viewed as a DDM MIMO modulation scheme. The processing per detected point at {rangeIndex, dopplerIndex} is illustrated in Figure below.</li>
</ul>
<p>Processing per detected point at {rangeIndex, dopplerIndex}.</p>
<p> <style>div.image img[src="aoa2dproc_dataflow2.png"]{width:80%}</style> </p><div class="image">
<img src="aoa2dproc_dataflow2.png" alt=""/>
<div class="caption">
Processing per detected point</div></div>
<p>The green block denoted by â€œCopy and Mapâ€ in Figure above, per detected point, copies the symbols of the detected points from the Doppler FFT output memory in HWA to the local memory, performs the mapping, and copies back the symbols to the HWA memory for the angle FFT calculation. This operation is performed by the function aoa2dProc_CopyMapAntSymbols(). The antenna symbols that are copied from the Doppler FFT output from the two locations into the local core memory are already BPM decoded. The mapping from the linear array from the local core memory into 2D antenna array y[col][row] in the HWA memory is performed using a table of type <a class="el" href="structDPU__Aoa2dProc__compRxChannelBiasCfg.html" title="Range Bias and rx channel gain/phase compensation configuration.">DPU_Aoa2dProc_compRxChannelBiasCfg</a> which is constructed by the demo function MmwDemo_cfgDopplerParamMapping() during the configuration time based on the antenna geometry specified by the CLI configuration command antGeometryCfg. The green block denoted by â€œCalculate X/Y/Zâ€ in Figure above is performed by function aoa2dProc_Calculate_XYZ().</p>
<p>The function is called per detected peak in range, Doppler and azimuth domain. If the detected peak satisfies all detection criteria it is placed in the final point cloud list. The following criteria must be satisfied:</p><ul>
<li><b>Peak falls inside a region of interest</b>: Each detected point is check to see if it falls in the region of interest specified by the CLI FOV commands. The boundaries of the region of interest in azimuth and elevation direction converted to indices are denoted as in the flow diagram as:<ul>
<li>aMin â€“ minimum index in azimuth dimension</li>
<li>aMax â€“ maximum index in azimuth dimension</li>
<li>eMin â€“ minimum index in elevation dimension</li>
<li>eMax â€“ maximum index in elevation dimension</li>
</ul>
</li>
<li><b>Peak is equal or greater than the side lobe threshol:</b>: The peak is checked against the side lobe threshold, ğ‘‡<sub>ğ‘˜</sub>. The side lobe threshold is calculated based on the FFT maximum in the 2dFFT output, multiplied with a fixed threshold scale. The threshold scale, (0 to 1), is provided by the CLI cfarCfg command. The condition is: ğ‘‹<sub>ğ‘˜,ğ‘—</sub> â‰¥ ğ‘‡<sub>ğ‘˜</sub></li>
</ul>
<p>Once all of these criteria are satisfied the further processing includes the following calculations.</p>
<ul>
<li><b>Peak position interpolation in azimuth dimension</b>: The peak azimuth index is corrected by fractional correction term ğ›¿<sub>ğ‘</sub>. The interpolation formula to calculate ğ›¿<sub>ğ‘</sub> is given by ğ›¿<sub>ğ‘</sub>=(|ğ‘‹<sub>ğ‘˜+1</sub>|âˆ’|ğ‘‹<sub>ğ‘˜âˆ’1</sub>|) / (4|ğ‘‹<sub>ğ‘˜</sub>|âˆ’2|ğ‘‹<sub>ğ‘˜+1</sub>|âˆ’2|ğ‘‹<sub>ğ‘˜âˆ’1</sub>|)<ul>
<li>The azimuth peak index ğ‘—, (previously converted to signed value), is corrected as: ğ‘—<sub>ğ‘ğ‘’ğ‘ğ‘˜</sub>=ğ‘—+ğ›¿<sub>ğ‘</sub></li>
</ul>
</li>
<li><b>Calculation of X,Y,Z coordinates</b>: The symbol phase increment between successive elements of antenna array in ğ‘¥ dimension is given by ğ‘Š<sub>ğ‘¥</sub> = ğœ†âˆ™ğ‘—<sub>ğ‘ğ‘’ğ‘ğ‘˜</sub> / ğ‘‘<sub>ğ‘¥</sub>âˆ™ğ‘<sub>ğ¹ğ¹ğ‘‡ğ‘ğ‘§ğ‘–ğ‘š</sub> (where ğ‘‘ is the distance between successive elements of the virtual antenna array and ğ‘ğ¹ğ¹ğ‘‡ğ‘ğ‘§ğ‘–ğ‘š is azimuth FFT size).<ul>
<li>The ğ‘¥ coordinate is calculated as ğ‘¥ = ğ‘Ÿâˆ™ğ‘Š<sub>ğ‘¥</sub></li>
<li>The symbol phase increment between successive elements of antenna array in ğ‘§ dimension is given by ğ‘Š<sub>ğ‘§</sub> = âˆ’ğœ†âˆ™ğ‘™<sub>ğ‘ğ‘’ğ‘ğ‘˜</sub> / ğ‘‘<sub>ğ‘§</sub>âˆ™ğ‘<sub>ğ¹ğ¹ğ‘‡ğ‘’ğ‘™ğ‘’ğ‘£</sub> (where ğ‘™<sub>ğ‘ğ‘’ğ‘ğ‘˜</sub> is elevation index (converted to signed value) of the peak and ğ‘ğ¹ğ¹ğ‘‡ğ‘’ğ‘™ğ‘’ğ‘£ is elevation FFT size).</li>
<li>The ğ‘§ coordinate is calculated as ğ‘§ = ğ‘Ÿâˆ™ğ‘Š<sub>ğ‘§</sub></li>
<li>The ğ‘¦ coordinate is calculated as  <style>div.image img[src="aoa2dproc_eq1.png"]{width:30%}</style> <div class="image">
<img src="aoa2dproc_eq1.png" alt=""/>
</div>
</li>
<li>The calculated coordinates, Doppler, noise and SNR are placed in the final output point-cloud list described as an array of structures: <div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>DPIF_PointCloudCartesianExt_t</div>
<div class="line">{</div>
<div class="line"><span class="comment">/* x - coordinate in meters */</span></div>
<div class="line"><span class="keywordtype">float</span> x;</div>
<div class="line"><span class="comment">/* y - coordinate in meters */</span></div>
<div class="line"><span class="keywordtype">float</span> y; </div>
<div class="line"><span class="comment">/* z - coordinate in meters */</span></div>
<div class="line"><span class="keywordtype">float</span> z; </div>
<div class="line"><span class="comment">/* radial Doppler velocity in m/s */</span></div>
<div class="line"><span class="keywordtype">float</span> velocity; </div>
<div class="line"><span class="comment">/* snr - CFAR cell to side noise ratio in dB */</span></div>
<div class="line"><span class="keywordtype">float</span> snr; </div>
<div class="line"><span class="comment">/* noise in dB */</span></div>
<div class="line"><span class="keywordtype">float</span> noise; </div>
<div class="line">} DPIF_PointCloudCartesianExt;</div>
</div><!-- fragment --> </li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="autotoc_md556"></a>
Usage Overview</h1>
<h2><a class="anchor" id="autotoc_md557"></a>
API</h2>
<ul>
<li><a class="el" href="aoa2dproc_8h.html#a07e243a90e85106ef4816a1d98d9e5d2">DPU_Aoa2dProc_init()</a>: This function allocates memory for the AOA2D DPU instance and initializes it to zero. It also constructs the semaphores used for processing.</li>
<li><a class="el" href="aoa2dproc_8h.html#aba48d6626946f36434087cd5c92701f1">DPU_Aoa2dProc_config()</a>: Based on the configuration parameters, this function configures HWA param sets and the input and output EDMA channels. The function is normally called one time before the sensor start command is issued to the RF.</li>
<li><a class="el" href="aoa2dproc_8h.html#a4771c3603025cf6a616a38e4d1484c13">DPU_Aoa2dProc_process()</a>: This function is called per frame after the CFAR DPU is completed.</li>
<li><a class="el" href="aoa2dproc_8h.html#aebf7f0c96f3edc8d3751d5ec641d6c69">DPU_Aoa2dProc_deinit()</a>: It frees the resources used for the DPU.</li>
<li><a class="el" href="aoa2dproc_8h.html#a85d2d73677ceab35da5ab54eb3693bd5">DPU_Aoa2dProc_GetNumUsedHwaParamSets()</a>: It returns the number of param sets allocated during the configuration time. It is called after the function <a class="el" href="aoa2dproc_8h.html#aba48d6626946f36434087cd5c92701f1">DPU_Aoa2dProc_config()</a> has been called.</li>
</ul>
<h1><a class="anchor" id="autotoc_md558"></a>
Example Usage</h1>
<p>Include the below file to access the APIs </p><div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="aoa2dproc_8h.html">datapath/dpu/aoa2dproc/v0/aoa2dproc.h</a>&gt;</span></div>
</div><!-- fragment --><p> DPU Initialization Example </p><div class="fragment"><div class="line"><a class="code" href="structDPU__Aoa2dProc__InitParams.html">DPU_Aoa2dProc_InitParams</a> initParams;</div>
<div class="line">initParams.<a class="code" href="structDPU__Aoa2dProc__InitParams.html#a7590945236625147520bbce27618589f">hwaHandle</a> =  hwaHandle;</div>
<div class="line">aoa2dProcDpuHandle =  <a class="code" href="aoa2dproc_8h.html#a07e243a90e85106ef4816a1d98d9e5d2">DPU_Aoa2dProc_init</a>(&amp;initParams, &amp;errorCode);</div>
<div class="line"><span class="keywordflow">if</span> (aoa2dProcDpuHandle == NULL)</div>
<div class="line">{</div>
<div class="line">    CLI_write (<span class="stringliteral">&quot;Error: AOA2D Proc DPU initialization returned error %d\n&quot;</span>, errorCode);</div>
<div class="line">    <a class="code" href="group__KERNEL__DPL__DEBUG.html#ga552e9055ca7eab5fe6c224c6cd5a9d4c">DebugP_assert</a> (0);</div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">}</div>
</div><!-- fragment --><p> DPU Configuration Parsing Example </p><div class="fragment"><div class="line">    hwRes = &amp;aoa2dProcDpuCfg.hwRes;</div>
<div class="line">    aoa2dStaticCfg = &amp;aoa2dProcDpuCfg.staticCfg;</div>
<div class="line">    edmaCfg = &amp;hwRes-&gt;edmaCfg;</div>
<div class="line">    hwaCfg = &amp;hwRes-&gt;hwaCfg;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    aoa2dStaticCfg-&gt;numAntRow = gMmwMssMCB.numAntRow;</div>
<div class="line">    aoa2dStaticCfg-&gt;numAntCol = gMmwMssMCB.numAntCol;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* FOV configuration */</span></div>
<div class="line">    aoa2dStaticCfg-&gt;fovAoaCfg = &amp;gMmwMssMCB.fovAoaCfg;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* From CFAR configuration */</span></div>
<div class="line">    aoa2dStaticCfg-&gt;sideLobeThresholdScaleQ8 = gMmwMssMCB.cfarCfg.sideLobeThresholdScaleQ8;</div>
<div class="line">    <span class="comment">/* Always true: */</span></div>
<div class="line">    aoa2dStaticCfg-&gt;enableInterpAzimuthDom = <span class="keyword">true</span>;</div>
<div class="line"> </div>
<div class="line">    gMmwMssMCB.adcStartTime         = (gMmwMssMCB.profileTimeCfg.h_ChirpAdcStartTime &gt;&gt; 10) * (1/gMmwMssMCB.adcSamplingRate); <span class="comment">//us</span></div>
<div class="line">    adcStart                        =   (gMmwMssMCB.adcStartTime * 1.e-6);</div>
<div class="line">    startFreq                       =   (float)(gMmwMssMCB.startFreq * 1.e9);</div>
<div class="line">    slope                           =   (float)(gMmwMssMCB.chirpSlope * 1.e12);</div>
<div class="line">    bandwidth                       =   (slope * gMmwMssMCB.profileComCfg.h_NumOfAdcSamples)/(gMmwMssMCB.adcSamplingRate * 1.e6);</div>
<div class="line">    centerFreq                      =   startFreq + bandwidth * 0.5f + adcStart * slope;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (gMmwMssMCB.antennaGeometryCfg.antDistanceXdim == 0.)</div>
<div class="line">    {</div>
<div class="line">        aoa2dStaticCfg-&gt;lambdaOverDistX = 2.0;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">    {</div>
<div class="line">        aoa2dStaticCfg-&gt;lambdaOverDistX = 3e8 / (centerFreq * gMmwMssMCB.antennaGeometryCfg.antDistanceXdim);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (gMmwMssMCB.antennaGeometryCfg.antDistanceZdim == 0.)</div>
<div class="line">    {</div>
<div class="line">        aoa2dStaticCfg-&gt;lambdaOverDistZ = 2.0;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">    {</div>
<div class="line">        aoa2dStaticCfg-&gt;lambdaOverDistZ = 3e8 / (centerFreq * gMmwMssMCB.antennaGeometryCfg.antDistanceZdim);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    aoa2dStaticCfg-&gt;numTxAntennas = (uint8_t) gMmwMssMCB.numTxAntennas;</div>
<div class="line">    aoa2dStaticCfg-&gt;numRxAntennas = (uint8_t) gMmwMssMCB.numRxAntennas;</div>
<div class="line">    aoa2dStaticCfg-&gt;numVirtualAntennas = (uint8_t) (gMmwMssMCB.numTxAntennas * gMmwMssMCB.numRxAntennas);</div>
<div class="line">    aoa2dStaticCfg-&gt;numRangeBins = gMmwMssMCB.numRangeBins;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (aoa2dStaticCfg-&gt;numTxAntennas &gt; 1)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">if</span> ((gMmwMssMCB.frameCfg.h_NumOfBurstsInFrame &gt; 1) &amp;&amp; (gMmwMssMCB.frameCfg.h_NumOfChirpsInBurst == 2))</div>
<div class="line">        {</div>
<div class="line">            <span class="comment">/* Burst mode: h_NumOfBurstsInFrame &gt; 1, h_NumOfChirpsInBurst = 2 */</span></div>
<div class="line">            aoa2dStaticCfg-&gt;numDopplerChirps   = gMmwMssMCB.frameCfg.h_NumOfBurstsInFrame;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (gMmwMssMCB.frameCfg.h_NumOfBurstsInFrame == 1)</div>
<div class="line">        {</div>
<div class="line">            <span class="comment">/* Normal mode: h_NumOfBurstsInFrame = 1, h_NumOfChirpsInBurst &gt;= aoa2dStaticCfg-&gt;numTxAntennas */</span></div>
<div class="line">            aoa2dStaticCfg-&gt;numDopplerChirps   = gMmwMssMCB.frameCfg.h_NumOfChirpsInBurst / aoa2dStaticCfg-&gt;numTxAntennas;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">        {</div>
<div class="line">            retVal = <a class="code" href="group__DPU__DOAPROC__ERROR__CODE.html#ga31f839287429f0f482f94d7d456e8fdf">DPU_DOAPROC_EINVAL</a>;</div>
<div class="line">            <span class="keywordflow">goto</span> exit;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">    {</div>
<div class="line">        <span class="comment">/* 1Tx antenna */</span></div>
<div class="line">        <span class="keywordflow">if</span> (gMmwMssMCB.frameCfg.h_NumOfBurstsInFrame != 1)</div>
<div class="line">        {</div>
<div class="line">            retVal = <a class="code" href="group__DPU__DOAPROC__ERROR__CODE.html#ga31f839287429f0f482f94d7d456e8fdf">DPU_DOAPROC_EINVAL</a>;</div>
<div class="line">            <span class="keywordflow">goto</span> exit;</div>
<div class="line">        }</div>
<div class="line">        aoa2dStaticCfg-&gt;numDopplerChirps = gMmwMssMCB.frameCfg.h_NumOfChirpsInBurst;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    aoa2dStaticCfg-&gt;numDopplerBins     = mathUtils_pow2roundup(aoa2dStaticCfg-&gt;numDopplerChirps);</div>
<div class="line">    aoa2dStaticCfg-&gt;log2NumDopplerBins = mathUtils_ceilLog2(aoa2dStaticCfg-&gt;numDopplerBins);</div>
<div class="line"> </div>
<div class="line">    aoa2dStaticCfg-&gt;numBpmDopplerChirps = aoa2dStaticCfg-&gt;numTxAntennas * aoa2dStaticCfg-&gt;numDopplerChirps;</div>
<div class="line">    aoa2dStaticCfg-&gt;bpmDopplerFftSize = aoa2dStaticCfg-&gt;numTxAntennas * aoa2dStaticCfg-&gt;numDopplerBins;</div>
<div class="line">    aoa2dStaticCfg-&gt;log2BpmDopplerFftSize = mathUtils_ceilLog2(aoa2dStaticCfg-&gt;bpmDopplerFftSize);</div>
<div class="line"> </div>
<div class="line">    gMmwMssMCB.numDopplerBins = aoa2dStaticCfg-&gt;numDopplerBins; </div>
<div class="line"> </div>
<div class="line">    aoa2dStaticCfg-&gt;angleDimension        = gMmwMssMCB.angleDimension;</div>
<div class="line">    aoa2dStaticCfg-&gt;isDetMatrixLogScale   = <span class="keyword">false</span>;</div>
<div class="line">    aoa2dStaticCfg-&gt;azimuthFftSize        = gMmwMssMCB.sigProcChainCfg.azimuthFftSize;</div>
<div class="line">    aoa2dStaticCfg-&gt;elevationFftSize      = gMmwMssMCB.sigProcChainCfg.elevationFftSize;</div>
<div class="line">    aoa2dStaticCfg-&gt;isStaticClutterRemovalEnabled = gMmwMssMCB.staticClutterRemovalEnable;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Configure Doppler fft param sets for mapping antennas into 1D/2D virtual antenna array */</span></div>
<div class="line">    retVal = MmwDemo_cfgDopplerParamMapping(&amp;hwaCfg-&gt;aoa2dRngGateCfg, DOPPLER_OUTPUT_MAPPING_DOP_ROW_COL);</div>
<div class="line">    <span class="keywordflow">if</span> (retVal &lt; 0)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">goto</span> exit;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* hwRes - copy these structures */</span></div>
<div class="line">    hwRes-&gt;radarCube = gMmwMssMCB.radarCube[0];</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* hwRes - edmaCfg */</span></div>
<div class="line">    edmaCfg-&gt;edmaHandle = gEdmaHandle[0];</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* edmaIn */</span></div>
<div class="line">    edmaCfg-&gt;edmaIn.channel =            DPC_OBJDET_DPU_AOA2D_PROC_EDMAIN_CH;</div>
<div class="line">    edmaCfg-&gt;edmaIn.channelShadow =      DPC_OBJDET_DPU_AOA2D_PROC_EDMAIN_SHADOW;</div>
<div class="line">    edmaCfg-&gt;edmaIn.eventQueue =         DPC_OBJDET_DPU_AOA2D_PROC_EDMAIN_EVENT_QUE;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* edmaHotSig */</span></div>
<div class="line">    edmaCfg-&gt;edmaHotSig.channel =             DPC_OBJDET_DPU_AOA2D_PROC_EDMAIN_SIG_CH;</div>
<div class="line">    edmaCfg-&gt;edmaHotSig.channelShadow =       DPC_OBJDET_DPU_AOA2D_PROC_EDMAIN_SIG_SHADOW;</div>
<div class="line">    edmaCfg-&gt;edmaHotSig.eventQueue =          DPC_OBJDET_DPU_AOA2D_PROC_EDMAIN_SIG_EVENT_QUE;</div>
<div class="line"> </div>
<div class="line">    edmaCfg-&gt;intrObj = &amp;intrObj_aoa2dProc;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* hwaCfg */</span></div>
<div class="line">    hwaCfg-&gt;hwaMemInpAddr = CSL_APP_HWA_DMA0_RAM_BANK0_BASE;</div>
<div class="line">    hwaCfg-&gt;numParamSets = 0;  <span class="comment">//The number depends on the configuration, will be populated by DPU_Aoa2dProc_config()</span></div>
<div class="line">    hwaCfg-&gt;paramSetStartIdx = gMmwMssMCB.numUsedHwaParamSets;</div>
<div class="line"> </div>
<div class="line">    hwaCfg-&gt;dmaTrigSrcChan = DPC_ObjDet_HwaDmaTrigSrcChanPoolAlloc(&amp;gMmwMssMCB.HwaDmaChanPoolObj);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* hwaCfg - window */</span></div>
<div class="line">    <span class="comment">/* Doppler FFT window */</span></div>
<div class="line">    hwaCfg-&gt;dopplerWindow.winRamOffset = DPC_ObjDet_HwaWinRamMemoryPoolAlloc(&amp;gMmwMssMCB.HwaWinRamMemoryPoolObj,</div>
<div class="line">                                                                               aoa2dStaticCfg-&gt;bpmDopplerFftSize / 2);<span class="comment">//aoa2dStaticCfg-&gt;numRangeBins + (aoa2dStaticCfg-&gt;numDopplerBins/2) ;</span></div>
<div class="line">    hwaCfg-&gt;dopplerWindow.winSym = <a class="code" href="group__HWA__WINDOW__SYMM.html#ga748023f5c56c565302c6d307911d6ae9">HWA_FFT_WINDOW_SYMMETRIC</a>; <span class="comment">// Symmetric window, store only half</span></div>
<div class="line">    hwaCfg-&gt;dopplerWindow.windowSize = <span class="keyword">sizeof</span>(uint32_t) * aoa2dStaticCfg-&gt;bpmDopplerFftSize / 2; <span class="comment">//symmetric window, for real samples (size in bytes)</span></div>
<div class="line">    hwaCfg-&gt;dopplerWindow.window =  (int32_t *)DPC_ObjDet_MemPoolAlloc(&amp;gMmwMssMCB.CoreLocalRamObj,</div>
<div class="line">                                                                       hwaCfg-&gt;dopplerWindow.windowSize,</div>
<div class="line">                                                                       <span class="keyword">sizeof</span>(uint32_t));</div>
<div class="line">    <span class="keywordflow">if</span> (hwaCfg-&gt;dopplerWindow.window == NULL)</div>
<div class="line">    {</div>
<div class="line">        retVal = DPC_OBJECTDETECTION_ENOMEM__CORE_LOCAL_RAM_AOA2D_HWA_WINDOW;</div>
<div class="line">        <span class="keywordflow">goto</span> exit;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (!gMmwMssMCB.oneTimeConfigDone)</div>
<div class="line">    {</div>
<div class="line">        mathUtils_genWindow((uint32_t *)hwaCfg-&gt;dopplerWindow.window,</div>
<div class="line">                            (uint32_t) aoa2dStaticCfg-&gt;bpmDopplerFftSize,</div>
<div class="line">                            hwaCfg-&gt;dopplerWindow.windowSize/<span class="keyword">sizeof</span>(uint32_t),</div>
<div class="line">                            DPC_DPU_DOPPLERPROC_FFT_WINDOW_TYPE,</div>
<div class="line">                            DPC_OBJDET_QFORMAT_DOPPLER_FFT);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Azimuth and elevation FFT window */</span></div>
<div class="line">    <span class="comment">//Share FFT window between azimuth and elevation FFT, window = [+1 -1 +1 -1 ... ]</span></div>
<div class="line">    winGenLen = (aoa2dStaticCfg-&gt;azimuthFftSize &gt; aoa2dStaticCfg-&gt;elevationFftSize) ? aoa2dStaticCfg-&gt;azimuthFftSize : aoa2dStaticCfg-&gt;elevationFftSize;</div>
<div class="line">    hwaCfg-&gt;angleWindow.windowSize = winGenLen * <span class="keyword">sizeof</span>(int32_t);</div>
<div class="line"> </div>
<div class="line">    hwaCfg-&gt;angleWindow.window = (int32_t *)DPC_ObjDet_MemPoolAlloc(&amp;gMmwMssMCB.CoreLocalRamObj,</div>
<div class="line">                                                                    hwaCfg-&gt;angleWindow.windowSize,</div>
<div class="line">                                                                    <span class="keyword">sizeof</span>(uint32_t));</div>
<div class="line">    <span class="keywordflow">if</span> (hwaCfg-&gt;angleWindow.window == NULL)</div>
<div class="line">    {</div>
<div class="line">        retVal = DPC_OBJECTDETECTION_ENOMEM__CORE_LOCAL_RAM_AOA2D_HWA_WINDOW;</div>
<div class="line">        <span class="keywordflow">goto</span> exit;</div>
<div class="line">    }</div>
<div class="line">    <span class="comment">/*Alternate 1,-1,...*/</span></div>
<div class="line">    <span class="keywordflow">for</span> (i=0; i&lt;winGenLen; i++)</div>
<div class="line">    {</div>
<div class="line">        hwaCfg-&gt;angleWindow.window[i] = (1 - 2 * (i &amp; 0x1)) * ((1&lt;&lt;17) - 1);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    hwaCfg-&gt;angleWindow.winRamOffset = DPC_ObjDet_HwaWinRamMemoryPoolAlloc(&amp;gMmwMssMCB.HwaWinRamMemoryPoolObj,</div>
<div class="line">                                                                             winGenLen);<span class="comment">//aoa2dStaticCfg-&gt;numRangeBins + (aoa2dStaticCfg-&gt;numDopplerBins/2) + (aoa2dStaticCfg-&gt;bpmDopplerFftSize/2);</span></div>
<div class="line">    hwaCfg-&gt;angleWindow.winSym = <a class="code" href="group__HWA__WINDOW__SYMM.html#ga2f24ccef10ca0541d2b705f78b7b8a64">HWA_FFT_WINDOW_NONSYMMETRIC</a>;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Rx compensation coefficients */</span></div>
<div class="line">    {</div>
<div class="line">        int32_t rxInd, txInd;</div>
<div class="line">        int32_t ind = 0;</div>
<div class="line">        aoa2dStaticCfg-&gt;compRxChanCfg.rangeBias = gMmwMssMCB.compRxChannelBiasCfg.rangeBias;</div>
<div class="line">        <span class="keywordflow">for</span> (txInd = 0; txInd &lt; aoa2dStaticCfg-&gt;numTxAntennas; txInd++)</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordflow">for</span> (rxInd = 0; rxInd &lt; aoa2dStaticCfg-&gt;numRxAntennas; rxInd++)</div>
<div class="line">            {</div>
<div class="line">                aoa2dStaticCfg-&gt;compRxChanCfg.rxChPhaseComp[ind++] = gMmwMssMCB.compRxChannelBiasCfg.rxChPhaseComp[gMmwMssMCB.rxAntOrder[rxInd] + (txInd * SYS_COMMON_NUM_RX_CHANNEL)];</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
</div><!-- fragment --><p> DPU Configuration Example </p><div class="fragment"><div class="line">retVal = <a class="code" href="aoa2dproc_8h.html#aba48d6626946f36434087cd5c92701f1">DPU_Aoa2dProc_config</a> (aoa2dProcDpuHandle, &amp;aoa2dProcDpuCfg);</div>
<div class="line"><span class="keywordflow">if</span> (retVal &lt; 0)</div>
<div class="line">{</div>
<div class="line">    CLI_write(<span class="stringliteral">&quot;AOA2D DPU config return error:%d \n&quot;</span>, retVal);</div>
<div class="line">    <a class="code" href="group__KERNEL__DPL__DEBUG.html#ga552e9055ca7eab5fe6c224c6cd5a9d4c">DebugP_assert</a>(0);</div>
<div class="line">}</div>
</div><!-- fragment --><p> DPU Process Trigger Example </p><div class="fragment"><div class="line">retVal = <a class="code" href="aoa2dproc_8h.html#a4771c3603025cf6a616a38e4d1484c13">DPU_Aoa2dProc_process</a>(aoa2dProcDpuHandle,</div>
<div class="line">                                       &amp;radarCube[0],</div>
<div class="line">                                       detRngDopList,</div>
<div class="line">                                       numDetectedPoints,</div>
<div class="line">                                       &amp;detectedRangeGates,</div>
<div class="line">                                       &amp;detMatrix,</div>
<div class="line">                                       &amp;outParmsAoa2d);</div>
<div class="line"><span class="keywordflow">if</span>(retVal &lt; 0)</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="group__KERNEL__DPL__DEBUG.html#gafe348ab5badd2c15118f95e21bb192c6">DebugP_log</a>(<span class="stringliteral">&quot;DEBUG: AoA2d DPU process return error:%d \n&quot;</span>, retVal);</div>
<div class="line">    <a class="code" href="group__KERNEL__DPL__DEBUG.html#ga552e9055ca7eab5fe6c224c6cd5a9d4c">DebugP_assert</a>(0);</div>
<div class="line">}</div>
</div><!-- fragment --><p> DPU Close Example </p><div class="fragment"><div class="line">retval = <a class="code" href="aoa2dproc_8h.html#aebf7f0c96f3edc8d3751d5ec641d6c69">DPU_Aoa2dProc_deinit</a>(Aoa2dProcDpuhandle)</div>
<div class="line"><span class="keywordflow">if</span>(retVal &lt; 0)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">/* Not Expected */</span></div>
<div class="line">    <a class="code" href="group__KERNEL__DPL__DEBUG.html#gafe348ab5badd2c15118f95e21bb192c6">DebugP_log</a>(<span class="stringliteral">&quot;AOA2dProc DPU deinit error %d\n&quot;</span>, retVal);</div>
<div class="line">    <a class="code" href="group__KERNEL__DPL__DEBUG.html#ga552e9055ca7eab5fe6c224c6cd5a9d4c">DebugP_assert</a>(0);</div>
<div class="line">}</div>
</div><!-- fragment --></div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<div class="ttc" id="agroup__HWA__WINDOW__SYMM_html_ga2f24ccef10ca0541d2b705f78b7b8a64"><div class="ttname"><a href="group__HWA__WINDOW__SYMM.html#ga2f24ccef10ca0541d2b705f78b7b8a64">HWA_FFT_WINDOW_NONSYMMETRIC</a></div><div class="ttdeci">#define HWA_FFT_WINDOW_NONSYMMETRIC</div><div class="ttdef"><b>Definition:</b> hwa/v0/hwa.h:255</div></div>
<div class="ttc" id="aaoa2dproc_8h_html_aebf7f0c96f3edc8d3751d5ec641d6c69"><div class="ttname"><a href="aoa2dproc_8h.html#aebf7f0c96f3edc8d3751d5ec641d6c69">DPU_Aoa2dProc_deinit</a></div><div class="ttdeci">int32_t DPU_Aoa2dProc_deinit(DPU_Aoa2dProc_Handle handle)</div></div>
<div class="ttc" id="aaoa2dproc_8h_html_aba48d6626946f36434087cd5c92701f1"><div class="ttname"><a href="aoa2dproc_8h.html#aba48d6626946f36434087cd5c92701f1">DPU_Aoa2dProc_config</a></div><div class="ttdeci">int32_t DPU_Aoa2dProc_config(DPU_Aoa2dProc_Handle handle, DPU_Aoa2dProc_Config *cfg)</div></div>
<div class="ttc" id="agroup__HWA__WINDOW__SYMM_html_ga748023f5c56c565302c6d307911d6ae9"><div class="ttname"><a href="group__HWA__WINDOW__SYMM.html#ga748023f5c56c565302c6d307911d6ae9">HWA_FFT_WINDOW_SYMMETRIC</a></div><div class="ttdeci">#define HWA_FFT_WINDOW_SYMMETRIC</div><div class="ttdef"><b>Definition:</b> hwa/v0/hwa.h:256</div></div>
<div class="ttc" id="aaoa2dproc_8h_html"><div class="ttname"><a href="aoa2dproc_8h.html">aoa2dproc.h</a></div><div class="ttdoc">Implements Data path AoA2D processing functionality.</div></div>
<div class="ttc" id="astructDPU__Aoa2dProc__InitParams_html_a7590945236625147520bbce27618589f"><div class="ttname"><a href="structDPU__Aoa2dProc__InitParams.html#a7590945236625147520bbce27618589f">DPU_Aoa2dProc_InitParams::hwaHandle</a></div><div class="ttdeci">HWA_Handle hwaHandle</div><div class="ttdef"><b>Definition:</b> aoa2dproc.h:192</div></div>
<div class="ttc" id="agroup__KERNEL__DPL__DEBUG_html_gafe348ab5badd2c15118f95e21bb192c6"><div class="ttname"><a href="group__KERNEL__DPL__DEBUG.html#gafe348ab5badd2c15118f95e21bb192c6">DebugP_log</a></div><div class="ttdeci">#define DebugP_log(format,...)</div><div class="ttdoc">Function to log a string to the enabled console.</div><div class="ttdef"><b>Definition:</b> DebugP.h:213</div></div>
<div class="ttc" id="aaoa2dproc_8h_html_a4771c3603025cf6a616a38e4d1484c13"><div class="ttname"><a href="aoa2dproc_8h.html#a4771c3603025cf6a616a38e4d1484c13">DPU_Aoa2dProc_process</a></div><div class="ttdeci">int32_t DPU_Aoa2dProc_process(DPU_Aoa2dProc_Handle handle, DPIF_RadarCube *radarCubeSrc, DPIF_CFARRngDopDetListElement *detRngDopList, uint32_t numDetPoints, DPIF_DetectedRangeGates *detectedRangeGates, DPIF_DetMatrix *detMatrix, DPU_Aoa2dProc_OutParams *outParams)</div></div>
<div class="ttc" id="aaoa2dproc_8h_html_a07e243a90e85106ef4816a1d98d9e5d2"><div class="ttname"><a href="aoa2dproc_8h.html#a07e243a90e85106ef4816a1d98d9e5d2">DPU_Aoa2dProc_init</a></div><div class="ttdeci">DPU_Aoa2dProc_Handle DPU_Aoa2dProc_init(DPU_Aoa2dProc_InitParams *initCfg, int32_t *errCode)</div></div>
<div class="ttc" id="astructDPU__Aoa2dProc__InitParams_html"><div class="ttname"><a href="structDPU__Aoa2dProc__InitParams.html">DPU_Aoa2dProc_InitParams</a></div><div class="ttdoc">dopplerProc DPU initial configuration parameters</div><div class="ttdef"><b>Definition:</b> aoa2dproc.h:191</div></div>
<div class="ttc" id="agroup__DPU__DOAPROC__ERROR__CODE_html_ga31f839287429f0f482f94d7d456e8fdf"><div class="ttname"><a href="group__DPU__DOAPROC__ERROR__CODE.html#ga31f839287429f0f482f94d7d456e8fdf">DPU_DOAPROC_EINVAL</a></div><div class="ttdeci">#define DPU_DOAPROC_EINVAL</div><div class="ttdoc">Error Code: Invalid argument.</div><div class="ttdef"><b>Definition:</b> doaproc.h:78</div></div>
<div class="ttc" id="agroup__KERNEL__DPL__DEBUG_html_ga552e9055ca7eab5fe6c224c6cd5a9d4c"><div class="ttname"><a href="group__KERNEL__DPL__DEBUG.html#ga552e9055ca7eab5fe6c224c6cd5a9d4c">DebugP_assert</a></div><div class="ttdeci">#define DebugP_assert(expression)</div><div class="ttdoc">Function to call for assert check.</div><div class="ttdef"><b>Definition:</b> DebugP.h:159</div></div>
<!-- HTML footer for doxygen 1.8.11-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.20 </li>
  </ul>
</div>
</body>
</html>
