<!-- HTML header for doxygen 1.8.11-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<link rel="shortcut icon" href="favicon.png" type="image/png">    
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<title>xWRL6432 MMWAVE-L-SDK: Watchdog reset mode</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<style>
.tinav {
    background: #c00;
    /* height: 41.375px; */
    height: 30px;
    }
</style>    
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() {
    if ($('.searchresults').length > 0) { searchBox.DOMSearchField().focus(); }
  });
  /* @license-end */
</script>
<link rel="search" href="search_opensearch.php?v=opensearch.xml" type="application/opensearchdescription+xml" title="xWRL6432 MMWAVE-L-SDK"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 40px;">
  <td id="projectlogo"><a href="https://www.ti.com"><img alt="Logo" src="ti_logo.svg"/></a></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">xWRL6432 MMWAVE-L-SDK
   &#160;<span id="projectnumber">05.05.04.02</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
          <div class="left">
            <form id="FSearchBox" action="search.html" method="get">
              <img id="MSearchSelect" src="search/mag.svg" alt=""/>
              <input type="text" id="MSearchField" name="query" value="Search" size="20" accesskey="S" 
                     onfocus="searchBox.OnSearchFieldFocus(true)" 
                     onblur="searchBox.OnSearchFieldFocus(false)"/>
            </form>
          </div><div class="right"></div>
        </div>
</td>
 </tr>
 </tbody>
</table>
<div class=tinav></div>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('EXAMPLES_DRIVERS_WATCHDOG_RESET_MODE.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Watchdog reset mode </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md809">Introduction</a></li>
<li class="level1"><a href="#EXAMPLES_DRIVERS_WATCHDOG_RESET_MODE_COMBOS">Supported Combinations</a></li>
<li class="level1"><a href="#autotoc_md810">Using SDK with SysConfig</a></li>
<li class="level1"><a href="#autotoc_md811">Flow chart</a></li>
<li class="level1"><a href="#autotoc_md812">Steps to Enable Reload Image from Flash/Reloading Application without reloading image from flash</a></li>
<li class="level1"><a href="#autotoc_md813">Steps to Run the Example</a></li>
<li class="level1"><a href="#autotoc_md814">See Also</a></li>
<li class="level1"><a href="#autotoc_md815">Sample Output</a></li>
</ul>
</div>
<div class="textblock"><p><a class="anchor" id="md_examples_drivers_watchdog_reset_mode"></a></p>
<h1><a class="anchor" id="autotoc_md809"></a>
Introduction</h1>
<p>This example uses the WDT module in reset mode to trigger SOC warm reset. Servicing the WDT for few iterations before triggering the warm reset. It will reset the device once it reaches the expiry time set by user.<br  />
 Make sure to confirm the following configuration in syscfg. <br  />
 <em>WDT Reset Mode: trigger warm reset</em>  <style>div.image img[src="wdt.png"]{width:35%}</style> </p><div class="image">
<img src="wdt.png" alt=""/>
</div>
<p> <br  />
 In this example we are trying to show two different flows: </p><ul>
<li>
Reload Image from Flash </li>
<li>
Reloading Application without reloading image from Flash </li>
</ul>
<h1><a class="anchor" id="EXAMPLES_DRIVERS_WATCHDOG_RESET_MODE_COMBOS"></a>
Supported Combinations</h1>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Parameter  </th><th class="markdownTableHeadNone">Value   </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">CPU + OS  </td><td class="markdownTableBodyNone">m4fss0-0 freertos   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Toolchain  </td><td class="markdownTableBodyNone">ti-arm-clang   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Boards  </td><td class="markdownTableBodyNone">xWRL6432-evm   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Example folder  </td><td class="markdownTableBodyNone">examples/drivers/watchdog/watchdog_reset/   </td></tr>
</table>
<h1><a class="anchor" id="autotoc_md810"></a>
Using SDK with SysConfig</h1>
<p>A GUI tool SysConfig is used to configure different modules and peripherals of the example. Using this tool, users can select and customize different modules and peripherals. The SysConfig tool will generate the code for initializing and configuring these modules. This configuration is saved to a file called example.syscfg for every example. To know more about how to use SDK with SysConfig, Visit this page</p>
<p><a class="el" href="SYSCONFIG_INTRO_PAGE.html">Using SDK with SysConfig</a></p>
<h1><a class="anchor" id="autotoc_md811"></a>
Flow chart</h1>
<p>The user can perform the following sequence if they want to reload complete image from flash during a watchdog reset. After exiting watchdog reset RBL is made to reload from flash by issuing a controlled warm reset with boot vector set to 0. Also when frontend is being used by the application, we have to ensure that frontend PD is ON to enable the RBL to load the frontend firmware. <br  />
  <style>div.image img[src="wdt-flow-reload.jpeg"]{width:50%}</style> </p><div class="image">
<img src="wdt-flow-reload.jpeg" alt=""/>
</div>
<p> <br  />
 If the user does not want to reload image from flash and when frontend is not being used we can maintain a backup of the data section so as to restore after watchdog reset. If the user reloads an image from Flash, we do not need to maintain a backup of the data section. The user can update the linker to have the data section only at the run address. <br  />
  <style>div.image img[src="wdt-flow.jpeg"]{width:30%}</style> </p><div class="image">
<img src="wdt-flow.jpeg" alt=""/>
</div>
<p> <br  />
</p>
<h1><a class="anchor" id="autotoc_md812"></a>
Steps to Enable Reload Image from Flash/Reloading Application without reloading image from flash</h1>
<ul>
<li>To <b>enable</b> reload image from flash the user can remove or comment out the following code in main.c <div class="fragment"><div class="line">/*if user does not want to reload image from flash and when frontend is not being used following will be</div>
<div class="line">required for resuming after a watchdog reset. This is to get a fresh copy of data section. If user</div>
<div class="line">is reloading image from flash then the following is not necessary and user can have data section only at </div>
<div class="line">run address by updating the linker.</div>
<div class="line">*/</div>
<div class="line"> </div>
<div class="line">/* Copying the data section from load memory to run memory location.*/</div>
<div class="line">uint32_t data_size = ((uintptr_t)&amp;__LOAD_DATA_END - (uintptr_t)&amp;__LOAD_DATA_START);</div>
<div class="line">memcpy((void*)&amp;__RUN_DATA_START,(void*)&amp;__LOAD_DATA_START,data_size);</div>
</div><!-- fragment --> <br  />
 and replace the contents of the linker file with the following: <div class="fragment"><div class="line">/* make sure below retain is there in your linker command file, it keeps the vector table in the final binary */</div>
<div class="line">--retain=&quot;*(.vectors)&quot;</div>
<div class="line">/* This is the stack that is used by code running within main()</div>
<div class="line">* In case of NORTOS,</div>
<div class="line">* - This means all the code outside of ISR uses this stack</div>
<div class="line">* In case of FreeRTOS</div>
<div class="line">* - This means all the code until vTaskStartScheduler() is called in main()</div>
<div class="line">*   uses this stack.</div>
<div class="line">* - After vTaskStartScheduler() each task created in FreeRTOS has its own stack</div>
<div class="line">*/</div>
<div class="line">--stack_size=8192</div>
<div class="line">/* This is the heap size for malloc() API in NORTOS and FreeRTOS</div>
<div class="line">* This is also the heap used by pvPortMalloc in FreeRTOS</div>
<div class="line">*/</div>
<div class="line">--heap_size=8192</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">SECTIONS</div>
<div class="line">{</div>
<div class="line">    /* This has the M4F entry point and vector table, this MUST be at 0x0 */</div>
<div class="line">    .vectors:{} palign(8) &gt; M4F_VECS</div>
<div class="line">    .bss:    {} palign(8) &gt; M4F_RAM12     /* This is where uninitialized globals go */</div>
<div class="line">    RUN_START(__BSS_START)</div>
<div class="line">    RUN_END(__BSS_END)</div>
<div class="line">    .text:   {} align(8) &gt;&gt; M4F_RAM12 | M4F_RAM3     /* This is where code resides */</div>
<div class="line">    .data:   {} align(8) &gt;&gt; M4F_RAM12 | M4F_RAM3     /* This is where initialized globals and static go */</div>
<div class="line">    .rodata: {} align(8) &gt;&gt; M4F_RAM12 | M4F_RAM3     /* This is where const&#39;s go */</div>
<div class="line">    .sysmem: {} palign(8) &gt; M4F_RBL     /* This is where the malloc heap goes */</div>
<div class="line">    .stack:  {} palign(8) &gt; M4F_RBL     /* This is where the main() stack goes */</div>
<div class="line">    .l3:     {} palign(8) &gt; HWASS_SHM_MEM     /* This is where L3 data goes */</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">MEMORY</div>
<div class="line">{</div>
<div class="line">    M4F_VECS : ORIGIN = 0x00400000 , LENGTH = 0x00000200</div>
<div class="line">    M4F_RAM12  : ORIGIN = 0x00400200 , LENGTH = (0x00058000 - 0x200) /* 32KB of RAM2 is being used by RBL */</div>
<div class="line">    M4F_RBL    : ORIGIN = 0x00458000 , LENGTH = 0x8000 /* 32KB of RAM2 is being used by RBL */</div>
<div class="line">    M4F_RAM3  : ORIGIN = 0x00460000 , LENGTH = 0x00020000</div>
<div class="line"> </div>
<div class="line">    HWASS_SHM_MEM : ORIGIN = 0x60000000, LENGTH = 0x00080000 /* 256KB in APPSS PD, 96KB in FECSS PD and 160KB in HWA PD */</div>
<div class="line">}</div>
</div><!-- fragment --> <br  />
</li>
<li>To <b>reload application without reloading image from flash</b> the user can remove or comment out the following code in main.c <div class="fragment"><div class="line">SOC_RstReason rstrsn;</div>
<div class="line">rstrsn = SOC_getRstReason();</div>
<div class="line">if (rstrsn == SOC_RESET_REASON_WARM)</div>
<div class="line">{</div>
<div class="line">    /* If user wants to reload complete image from flash during a watchdog reset following</div>
<div class="line">    sequence can be followed. After exiting watchdog reset RBL is made to reload from flash</div>
<div class="line">    by issuing a controlled warm reset with boot vector set to 0. Also when frontend is being</div>
<div class="line">    used by the application, we have to ensure that frontend PD is ON to enable RBL load </div>
<div class="line">    frontend firmware.      </div>
<div class="line">    */</div>
<div class="line">    handleWdtRst();</div>
<div class="line">}</div>
</div><!-- fragment --> and replace the contents of the linker file with the following: <div class="fragment"><div class="line">/* make sure below retain is there in your linker command file, it keeps the vector table in the final binary */</div>
<div class="line">--retain=&quot;*(.vectors)&quot;</div>
<div class="line">/* This is the stack that is used by code running within main()</div>
<div class="line"> * In case of NORTOS,</div>
<div class="line"> * - This means all the code outside of ISR uses this stack</div>
<div class="line"> * In case of FreeRTOS</div>
<div class="line"> * - This means all the code until vTaskStartScheduler() is called in main()</div>
<div class="line"> *   uses this stack.</div>
<div class="line"> * - After vTaskStartScheduler() each task created in FreeRTOS has its own stack</div>
<div class="line"> */</div>
<div class="line">--stack_size=8192</div>
<div class="line">/* This is the heap size for malloc() API in NORTOS and FreeRTOS</div>
<div class="line"> * This is also the heap used by pvPortMalloc in FreeRTOS</div>
<div class="line"> */</div>
<div class="line">--heap_size=8192</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">SECTIONS</div>
<div class="line">{</div>
<div class="line">    /* This has the M4F entry point and vector table, this MUST be at 0x0 */</div>
<div class="line">    .vectors:{} palign(8) &gt; M4F_VECS</div>
<div class="line">    .bss:    {} palign(8) &gt; M4F_RAM12     /* This is where uninitialized globals go */</div>
<div class="line">    RUN_START(__BSS_START)</div>
<div class="line">    RUN_END(__BSS_END)</div>
<div class="line">    /*</div>
<div class="line">    * Maintaining a backup of data section so as to restore after watchdog reset</div>
<div class="line">    * As program executes data section will be updated. During watchdog/warm reset,</div>
<div class="line">    * as RBL does not reload from flash we copy the data section from backed up memory</div>
<div class="line">    * location.</div>
<div class="line">    */</div>
<div class="line">    GROUP                       </div>
<div class="line">    {</div>
<div class="line">        .data:   {} palign(8)   /* This is where initialized globals and static go */</div>
<div class="line">        LOAD_START(__LOAD_DATA_START)</div>
<div class="line">        LOAD_END(__LOAD_DATA_END)</div>
<div class="line">        RUN_START(__RUN_DATA_START)</div>
<div class="line">    } load &gt; M4F_DATALOAD,  run &gt; M4F_DATARUN</div>
<div class="line">    .text:   {} align(8) &gt;&gt; M4F_RAM12 | M4F_RAM3     /* This is where code resides */</div>
<div class="line">    .rodata: {} align(8) &gt;&gt; M4F_RAM12 | M4F_RAM3     /* This is where const&#39;s go */</div>
<div class="line">    .sysmem: {} palign(8) &gt; M4F_RBL     /* This is where the malloc heap goes */</div>
<div class="line">    .stack:  {} palign(8) &gt; M4F_RBL     /* This is where the main() stack goes */</div>
<div class="line">    .l3:     {} palign(8) &gt; HWASS_SHM_MEM     /* This is where L3 data goes */</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">MEMORY</div>
<div class="line">{</div>
<div class="line">    M4F_VECS : ORIGIN = 0x00400000 , LENGTH = 0x00000200</div>
<div class="line">    M4F_RAM12  : ORIGIN = 0x00400200 , LENGTH = (0x00058000 - 0x200) /* 32KB of RAM2 is being used by RBL */</div>
<div class="line">    M4F_RBL    : ORIGIN = 0x00458000 , LENGTH = 0x8000 /* 32KB of RAM2 is being used by RBL */</div>
<div class="line">    M4F_RAM3  : ORIGIN = 0x00460000 , LENGTH = 0x0001F000</div>
<div class="line">    /* when using multi-core application&#39;s i.e more than one m4F active, make sure</div>
<div class="line">     * this memory does not overlap with other m4F&#39;s</div>
<div class="line">     */</div>
<div class="line">    M4F_DATALOAD     : ORIGIN = 0x0047F000 , LENGTH = 0x800  /*Memory space where data section is loaded*/</div>
<div class="line">    M4F_DATARUN     : ORIGIN = 0x0047F800 , LENGTH = 0x800  /*Memory space of data section during runtime*/</div>
<div class="line"> </div>
<div class="line">    HWASS_SHM_MEM : ORIGIN = 0x60000000, LENGTH = 0x00068000 /* 256KB in APPSS PD and 160KB in HWA PD */</div>
<div class="line">}</div>
</div><!-- fragment --></li>
</ul>
<h1><a class="anchor" id="autotoc_md813"></a>
Steps to Run the Example</h1>
<ul>
<li><b>When using CCS projects to build</b>, import the CCS project for the required combination and build it using the CCS project menu (see <a class="el" href="CCS_PROJECTS_PAGE.html">Using SDK with CCS Projects</a>).</li>
<li><b>When using makefiles to build</b>, note the required combination and build using make command (see <a class="el" href="MAKEFILE_BUILD_PAGE.html">Using SDK with Makefiles</a>)</li>
<li>Launch a CCS debug session and run the executable, see <a class="el" href="CCS_LAUNCH_PAGE.html">CCS Launch, Load and Run</a></li>
<li>Please select the UART port used for console as mentioned in <a class="el" href="EVM_SETUP_PAGE.html#CCS_UART_TERMINAL">Setup UART Terminal</a></li>
</ul>
<h1><a class="anchor" id="autotoc_md814"></a>
See Also</h1>
<p><a class="el" href="DRIVERS_WATCHDOG_PAGE.html">WATCHDOG</a></p>
<h1><a class="anchor" id="autotoc_md815"></a>
Sample Output</h1>
<p>Shown below is a sample output when the application is run, Please note that application prints in both CCS and UART console.<br  />
 CCS Console: </p><div class="fragment"><div class="line">[MAIN_Cortex_R5_0_0] Watchdog reset Mode Test Started ...</div>
<div class="line">Servicing WDT for few iterations</div>
<div class="line">Watchdog triggers warm reset in 3000 (ms)</div>
<div class="line">All tests have passed!!</div>
<div class="line">Prints will be stopped after reset</div>
<div class="line">Prints will be stopped after reset</div>
<div class="line">Prints will be stopped after reset</div>
<div class="line">&#39;&#39; &#39;&#39;</div>
<div class="line">&#39;&#39; &#39;&#39;</div>
<div class="line">&#39;&#39; &#39;&#39;</div>
<div class="line">Prints will be stopped after reset</div>
</div><!-- fragment --><p>UART Console: </p><div class="fragment"><div class="line">Watchdog reset Mode Test Started ...</div>
<div class="line">Servicing WDT for few iterations</div>
<div class="line">Watchdog triggers warm reset in 3000 (ms)</div>
<div class="line">All tests have passed!!</div>
<div class="line">Prints will be stopped after reset</div>
<div class="line">Prints will be stopped after reset</div>
<div class="line">Prints will be stopped after reset</div>
<div class="line">&#39;&#39; &#39;&#39;</div>
<div class="line">&#39;&#39; &#39;&#39;</div>
<div class="line">&#39;&#39; &#39;&#39;</div>
<div class="line">Prints will be stopped after reset</div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>Console prints will be stopped once WDT triggers warm reset. </dd></dl>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.11-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.20 </li>
  </ul>
</div>
</body>
</html>
