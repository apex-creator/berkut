<!-- HTML header for doxygen 1.8.11-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<link rel="shortcut icon" href="favicon.png" type="image/png">    
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<title>xWRL1432 MMWAVE-L-SDK: Mpdproc</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<style>
.tinav {
    background: #c00;
    /* height: 41.375px; */
    height: 30px;
    }
</style>    
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() {
    if ($('.searchresults').length > 0) { searchBox.DOMSearchField().focus(); }
  });
  /* @license-end */
</script>
<link rel="search" href="search_opensearch.php?v=opensearch.xml" type="application/opensearchdescription+xml" title="xWRL1432 MMWAVE-L-SDK"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 40px;">
  <td id="projectlogo"><a href="https://www.ti.com"><img alt="Logo" src="ti_logo.svg"/></a></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">xWRL1432 MMWAVE-L-SDK
   &#160;<span id="projectnumber">05.05.04.02</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
          <div class="left">
            <form id="FSearchBox" action="search.html" method="get">
              <img id="MSearchSelect" src="search/mag.svg" alt=""/>
              <input type="text" id="MSearchField" name="query" value="Search" size="20" accesskey="S" 
                     onfocus="searchBox.OnSearchFieldFocus(true)" 
                     onblur="searchBox.OnSearchFieldFocus(false)"/>
            </form>
          </div><div class="right"></div>
        </div>
</td>
 </tr>
 </tbody>
</table>
<div class=tinav></div>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('MPDPROC_PAGE.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Mpdproc </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md505">Introduction</a></li>
<li class="level1"><a href="#autotoc_md506">Block Diagram</a></li>
<li class="level1"><a href="#autotoc_md507">MPD DPU Functioning</a></li>
<li class="level1"><a href="#autotoc_md508">Usage Overview</a><ul><li class="level2"><a href="#autotoc_md509">API</a></li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md510">Example Usage</a></li>
</ul>
</div>
<div class="textblock"><p><a class="anchor" id="md_components_datapath_mpdproc"></a></p>
<h1><a class="anchor" id="autotoc_md505"></a>
Introduction</h1>
<p>The Motion and presence detect or MPD DPU is a higher level processing layer which detects motion and presence state in a defined region of interest, based on the input point cloud.</p>
<h1><a class="anchor" id="autotoc_md506"></a>
Block Diagram</h1>
<p>The top-level block diagram of the DPU is shown in the figure below.</p>
<p> <style>div.image img[src="mpdproc.png"]{width:80%}</style> </p><div class="image">
<img src="mpdproc.png" alt=""/>
<div class="caption">
MPD DPU top-level diagram</div></div>
<h1><a class="anchor" id="autotoc_md507"></a>
MPD DPU Functioning</h1>
<p>The MPD DPU processing flow is shown below.</p>
<p> <style>div.image img[src="mpdproc_flow.png"]{width:30%}</style> </p><div class="image">
<img src="mpdproc_flow.png" alt=""/>
<div class="caption">
MPD DPU processing flow</div></div>
<p>This DPU performs the following two major computations:-</p><ul>
<li>Clustering: of the input point cloud data based on the the user provided clusterCfg - CLI configuration. It has the following parameters:<ul>
<li>Cluster radius: The radius (in meters) of the neighborhood around a point (i.e., epsilon in DBSCAN algorithm). Note that the clustering takes the geometric difference between the detected point's range and the centroid's for a given cluster,</li>
<li>minPoints: Minimum number of neighbor points required within the epsilon radius around the point under test, to constitute a cluster</li>
</ul>
</li>
<li>State machine: Each cluster is then mapped to the corresponding zones or boundary boxes of interest, based on the dimensions from CLI configuration - mpdBoundaryBox. Also, the state machine considers the history across a given n frames, to update the zone's state. This is user configurable through the CLI command - majorStateParam or minorStateParam. The output of this DPU is an 8-bit unsigned integer array, whose 0th index indicates the number of zones processed. The subsequent indices are split into 2-bit values for every zone(one for major motion and other for minor motion detection) and the maximum array index is computed as (num_of_zones*2-bits_per_zone)/8-bits_per_array_index</li>
</ul>
<h1><a class="anchor" id="autotoc_md508"></a>
Usage Overview</h1>
<h2><a class="anchor" id="autotoc_md509"></a>
API</h2>
<p>The Presence Detection (mpdproc) DPU APIs are listed below. In the presence detect OOB chain, these mpdproc DPU APIs are exercised only if the DPU processing flag (isMotionPresenceDpuEnabled) is enabled.</p>
<ul>
<li><a class="el" href="mpdproc_8h.html#ac6c2886f8eebd5daef0b76e804d86813">DPU_MpdProc_init()</a>: This function allocates memory for the DPU instance and initializes it to zero.</li>
<li><a class="el" href="mpdproc_8h.html#a412b78192006d9a628e4869c753bf953">DPU_MpdProc_config()</a>: Based on the configuration parameters, this function configures the DPU parameters to be able to perform clustering and presence detection computations for each configured zone. The function is normally called one time before the sensor start command is issued to the RF. In the low power deep sleep mode, the function is called per frame.</li>
<li><p class="startli"><a class="el" href="mpdproc_8h.html#a5eb757955098b61c283e0770e64dbdd1">DPU_MpdProc_process()</a>: This function is called per frame after the CFAR DPU is completed. It is called only once, irrespective of the motion modes â€“ major/minor/auto and internally handles the processing for these modes accordingly. The input argument to the function is</p><ul>
<li>pointer to the DPU instance/handle, which in-turn consists of pointer(s) to the point cloud output(s) of CFAR DPU</li>
</ul>
<p class="startli">The output arguments to the function are</p><ul>
<li>pointer to the output presence detect information per zone. The function performs the following steps:</li>
<li>clustering of the point cloud to group/map them to the configured zones by calling function assignPointsToZones()</li>
<li>performs the processing to determine the presence detected state of each zone, by running the state machine function stateMachine().</li>
</ul>
</li>
<li><a class="el" href="mpdproc_8h.html#aa2cd16a42a5b99d4257ebb1d6d36e883">DPU_MpdProc_deinit()</a>: It frees the resources used for the DPU.</li>
</ul>
<h1><a class="anchor" id="autotoc_md510"></a>
Example Usage</h1>
<p>Include the below file to access the APIs </p><div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="mpdproc_8h.html">datapath/dpu/mpdproc/v0/mpdproc.h</a>&gt;</span></div>
</div><!-- fragment --><p> DPU Initialization Example </p><div class="fragment"><div class="line">mpdProcDpuHandle =  <a class="code" href="mpdproc_8h.html#ac6c2886f8eebd5daef0b76e804d86813">DPU_MpdProc_init</a>(&amp;errorCode);</div>
<div class="line"><span class="keywordflow">if</span> (mpdProcDpuHandle == NULL)</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="group__KERNEL__DPL__DEBUG.html#gafe348ab5badd2c15118f95e21bb192c6">DebugP_log</a> (<span class="stringliteral">&quot;Debug: MPD Proc DPU initialization returned error %d\n&quot;</span>, errorCode);</div>
<div class="line">    <a class="code" href="group__KERNEL__DPL__DEBUG.html#ga552e9055ca7eab5fe6c224c6cd5a9d4c">DebugP_assert</a> (0);</div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">}</div>
</div><!-- fragment --><p> DPU Configuration Parsing Example </p><div class="fragment"><div class="line">    pHwConfig = &amp;mpdProcDpuCfg.res;</div>
<div class="line">    params = &amp;mpdProcDpuCfg.staticCfg;</div>
<div class="line"> </div>
<div class="line">    memset((<span class="keywordtype">void</span> *)&amp;mpdProcDpuCfg, 0, <span class="keyword">sizeof</span>(<a class="code" href="structDPU__MpdProc__Config.html">DPU_MpdProc_Config</a>));</div>
<div class="line">    </div>
<div class="line">    pHwConfig-&gt;zones = gMmwMssMCB.dpcZones;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Initializing the zones structure based on CLI config. CAUTION: Accumulates history across frames */</span></div>
<div class="line">    <span class="keywordflow">if</span> (!gMmwMssMCB.oneTimeConfigDone)</div>
<div class="line">    {</div>
<div class="line">        memset((<span class="keywordtype">void</span> *)pHwConfig-&gt;zones, 0, (gMmwMssMCB.sceneryParams.numBoundaryBoxes * <span class="keyword">sizeof</span>(<a class="code" href="structmpdProc__MotionTracker.html">mpdProc_MotionTracker</a>)));</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span>(i = 0;i &lt; gMmwMssMCB.sceneryParams.numBoundaryBoxes;i++)</div>
<div class="line">        {</div>
<div class="line">            pHwConfig-&gt;zones[i].pointHistBufferMajor.bufferSize = gMmwMssMCB.majorStateParamCfg.histBufferSize;</div>
<div class="line">            pHwConfig-&gt;zones[i].pointHistBufferMajor.oldest = gMmwMssMCB.majorStateParamCfg.histBufferSize - 1;</div>
<div class="line">            </div>
<div class="line">            pHwConfig-&gt;zones[i].snrHistBufferMajor.bufferSize = gMmwMssMCB.majorStateParamCfg.histBufferSize;</div>
<div class="line">            pHwConfig-&gt;zones[i].snrHistBufferMajor.oldest = gMmwMssMCB.majorStateParamCfg.histBufferSize - 1;</div>
<div class="line">            </div>
<div class="line">            pHwConfig-&gt;zones[i].pointHistBufferMinor.bufferSize = gMmwMssMCB.minorStateParamCfg.histBufferSize;</div>
<div class="line">            pHwConfig-&gt;zones[i].pointHistBufferMinor.oldest = gMmwMssMCB.minorStateParamCfg.histBufferSize - 1;</div>
<div class="line"> </div>
<div class="line">            pHwConfig-&gt;zones[i].snrHistBufferMinor.bufferSize = gMmwMssMCB.minorStateParamCfg.histBufferSize;</div>
<div class="line">            pHwConfig-&gt;zones[i].snrHistBufferMinor.oldest = gMmwMssMCB.minorStateParamCfg.histBufferSize - 1;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    pHwConfig-&gt;numDetMajor = (uint16_t *)&amp;gMmwMssMCB.dpcResult.numObjOutMajor;</div>
<div class="line">    pHwConfig-&gt;numDetMinor = (uint16_t *)&amp;gMmwMssMCB.dpcResult.numObjOutMinor;</div>
<div class="line">    pHwConfig-&gt;detObjMajor = (DPIF_PointCloudCartesianExt *)&amp;gMmwMssMCB.cfarDetObjOut[0];</div>
<div class="line">    pHwConfig-&gt;detObjMinor = (DPIF_PointCloudCartesianExt *)&amp;gMmwMssMCB.cfarDetObjOut[0];</div>
<div class="line">    </div>
<div class="line">    params-&gt;motionMode = (uint8_t)gMmwMssMCB.sigProcChainCfg.motDetMode;</div>
<div class="line">    </div>
<div class="line">    memcpy(&amp;params-&gt;sceneryParams, &amp;gMmwMssMCB.sceneryParams, <span class="keyword">sizeof</span>(<a class="code" href="structmpdProc__SceneryParams.html">mpdProc_SceneryParams</a>));</div>
<div class="line">    memcpy(&amp;params-&gt;clusterParams, &amp;gMmwMssMCB.clusterParamCfg, <span class="keyword">sizeof</span>(<a class="code" href="structmpdProc__ClusterParamCfg.html">mpdProc_ClusterParamCfg</a>));</div>
<div class="line">    memcpy(&amp;params-&gt;majorStateParamCfg, &amp;gMmwMssMCB.majorStateParamCfg, <span class="keyword">sizeof</span>(<a class="code" href="structmpdProc__MotionModeStateParamCfg.html">mpdProc_MotionModeStateParamCfg</a>));</div>
<div class="line">    memcpy(&amp;params-&gt;minorStateParamCfg, &amp;gMmwMssMCB.minorStateParamCfg, <span class="keyword">sizeof</span>(<a class="code" href="structmpdProc__MotionModeStateParamCfg.html">mpdProc_MotionModeStateParamCfg</a>));</div>
</div><!-- fragment --><p> DPU Configuration Example </p><div class="fragment"><div class="line">retVal = <a class="code" href="mpdproc_8h.html#a412b78192006d9a628e4869c753bf953">DPU_MpdProc_config</a>(mpdProcDpuHandle, &amp;mpdProcDpuCfg);</div>
<div class="line"><span class="keywordflow">if</span> (retVal &lt; 0)</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="group__KERNEL__DPL__DEBUG.html#gafe348ab5badd2c15118f95e21bb192c6">DebugP_log</a>(<span class="stringliteral">&quot;DEBUG: MPD DPU config return error:%d \n&quot;</span>, retVal);</div>
<div class="line">    <a class="code" href="group__KERNEL__DPL__DEBUG.html#ga552e9055ca7eab5fe6c224c6cd5a9d4c">DebugP_assert</a>(0);</div>
<div class="line">}</div>
</div><!-- fragment --><p> DPU Process Trigger Example </p><div class="fragment"><div class="line">retVal = <a class="code" href="mpdproc_8h.html#a5eb757955098b61c283e0770e64dbdd1">DPU_MpdProc_process</a>(mpdProcDpuHandle, &amp;outParmsMpdproc);</div>
<div class="line"><span class="keywordflow">if</span>(retVal != 0){</div>
<div class="line">    <a class="code" href="group__KERNEL__DPL__DEBUG.html#gafe348ab5badd2c15118f95e21bb192c6">DebugP_log</a>(<span class="stringliteral">&quot;DEBUG: DPU_MpdProc_process failed with error code %d&quot;</span>, retVal);</div>
<div class="line">    <a class="code" href="group__KERNEL__DPL__DEBUG.html#ga552e9055ca7eab5fe6c224c6cd5a9d4c">DebugP_assert</a>(0);</div>
<div class="line">}</div>
</div><!-- fragment --><p> DPU Close Example </p><div class="fragment"><div class="line">retval = <a class="code" href="mpdproc_8h.html#aa2cd16a42a5b99d4257ebb1d6d36e883">DPU_MpdProc_deinit</a>(MpdProcDpuhandle)</div>
<div class="line"><span class="keywordflow">if</span>(retVal &lt; 0)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">/* Not Expected */</span></div>
<div class="line">    <a class="code" href="group__KERNEL__DPL__DEBUG.html#gafe348ab5badd2c15118f95e21bb192c6">DebugP_log</a>(<span class="stringliteral">&quot;MPDProc DPU deinit error %d\n&quot;</span>, retVal);</div>
<div class="line">    <a class="code" href="group__KERNEL__DPL__DEBUG.html#ga552e9055ca7eab5fe6c224c6cd5a9d4c">DebugP_assert</a>(0);</div>
<div class="line">}</div>
</div><!-- fragment --></div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<div class="ttc" id="astructDPU__MpdProc__Config_html"><div class="ttname"><a href="structDPU__MpdProc__Config.html">DPU_MpdProc_Config</a></div><div class="ttdoc">Motion Presence Detection configuration.</div><div class="ttdef"><b>Definition:</b> mpdproc.h:249</div></div>
<div class="ttc" id="astructmpdProc__SceneryParams_html"><div class="ttname"><a href="structmpdProc__SceneryParams.html">mpdProc_SceneryParams</a></div><div class="ttdoc">GTRACK Scenery Parameters.</div><div class="ttdef"><b>Definition:</b> mpdproc.h:62</div></div>
<div class="ttc" id="ampdproc_8h_html_aa2cd16a42a5b99d4257ebb1d6d36e883"><div class="ttname"><a href="mpdproc_8h.html#aa2cd16a42a5b99d4257ebb1d6d36e883">DPU_MpdProc_deinit</a></div><div class="ttdeci">int32_t DPU_MpdProc_deinit(DPU_MpdProc_Handle handle)</div></div>
<div class="ttc" id="ampdproc_8h_html_ac6c2886f8eebd5daef0b76e804d86813"><div class="ttname"><a href="mpdproc_8h.html#ac6c2886f8eebd5daef0b76e804d86813">DPU_MpdProc_init</a></div><div class="ttdeci">DPU_MpdProc_Handle DPU_MpdProc_init(int32_t *errCode)</div></div>
<div class="ttc" id="astructmpdProc__ClusterParamCfg_html"><div class="ttname"><a href="structmpdProc__ClusterParamCfg.html">mpdProc_ClusterParamCfg</a></div><div class="ttdef"><b>Definition:</b> mpdproc.h:74</div></div>
<div class="ttc" id="ampdproc_8h_html_a412b78192006d9a628e4869c753bf953"><div class="ttname"><a href="mpdproc_8h.html#a412b78192006d9a628e4869c753bf953">DPU_MpdProc_config</a></div><div class="ttdeci">int32_t DPU_MpdProc_config(DPU_MpdProc_Handle handle, DPU_MpdProc_Config *pConfigIn)</div></div>
<div class="ttc" id="astructmpdProc__MotionTracker_html"><div class="ttname"><a href="structmpdProc__MotionTracker.html">mpdProc_MotionTracker</a></div><div class="ttdef"><b>Definition:</b> mpdproc.h:155</div></div>
<div class="ttc" id="agroup__KERNEL__DPL__DEBUG_html_gafe348ab5badd2c15118f95e21bb192c6"><div class="ttname"><a href="group__KERNEL__DPL__DEBUG.html#gafe348ab5badd2c15118f95e21bb192c6">DebugP_log</a></div><div class="ttdeci">#define DebugP_log(format,...)</div><div class="ttdoc">Function to log a string to the enabled console.</div><div class="ttdef"><b>Definition:</b> DebugP.h:213</div></div>
<div class="ttc" id="ampdproc_8h_html_a5eb757955098b61c283e0770e64dbdd1"><div class="ttname"><a href="mpdproc_8h.html#a5eb757955098b61c283e0770e64dbdd1">DPU_MpdProc_process</a></div><div class="ttdeci">int32_t DPU_MpdProc_process(DPU_MpdProc_Handle handle, DPU_MpdProc_OutParams *outParams)</div></div>
<div class="ttc" id="agroup__KERNEL__DPL__DEBUG_html_ga552e9055ca7eab5fe6c224c6cd5a9d4c"><div class="ttname"><a href="group__KERNEL__DPL__DEBUG.html#ga552e9055ca7eab5fe6c224c6cd5a9d4c">DebugP_assert</a></div><div class="ttdeci">#define DebugP_assert(expression)</div><div class="ttdoc">Function to call for assert check.</div><div class="ttdef"><b>Definition:</b> DebugP.h:159</div></div>
<div class="ttc" id="ampdproc_8h_html"><div class="ttname"><a href="mpdproc_8h.html">mpdproc.h</a></div></div>
<div class="ttc" id="astructmpdProc__MotionModeStateParamCfg_html"><div class="ttname"><a href="structmpdProc__MotionModeStateParamCfg.html">mpdProc_MotionModeStateParamCfg</a></div><div class="ttdef"><b>Definition:</b> mpdproc.h:96</div></div>
<!-- HTML footer for doxygen 1.8.11-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.20 </li>
  </ul>
</div>
</body>
</html>
